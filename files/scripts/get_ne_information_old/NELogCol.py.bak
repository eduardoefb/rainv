#!/usr/bin/python

"""
Network element log collector version 0.0.1  2016/03/07

Suports: BSC, RNC, Flexi NS
"""

import getpass
import sys
import telnetlib
import os
import tempfile
import shutil
import time
import threading
import paramiko
import zipfile
from random import choice
from string import ascii_uppercase

def getDateString():
	year = time.localtime().tm_year
	mon = time.localtime().tm_mon
	day = time.localtime().tm_mday
	
	if mon < 10:
		mon_str = "0" + str(mon)
	else:
		mon_str = str(mon)

	if day < 10:
		day_str = "0" + str(day)
	else:
		day_str = str(day)
	
	return str(year) + mon_str + day_str
		
def zipdir(path, ziph):
    # ziph is zipfile handle
    for root, dirs, files in os.walk(path):
        for file in files:
            ziph.write(os.path.join(root, file))

def copy_sftp_file(ip, user, pwd, remotePath, localPath):
	ssh = paramiko.SSHClient()
	ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
	try:
		ssh.connect(ip,username=user,password=pwd)
		### Copy remote file to server        
		sftp = ssh.open_sftp()
		sftp.get(remotePath,localPath)
		sftp.close()
		ssh.close()
		return ["OK",0,0]
	except IOError as e:
		flash(str(e)+" IOERROR")
		return ["IOERROR: " + str(e),0,0]
	except Exception as e:
		flash(str(e)+" OTHER EXCEPTION")
		return ["Error: " + str(e),0,0]    

def ssh_connect(ip, usr, pwd):
	nbytes = 4096
	hostname = ip
	port = 22
	username = usr
	password = pwd
	
	client = paramiko.Transport((hostname, port))
	client.connect(username=username, password=password)
	return client
		
def ssh_disconnect(client):
	client.close()
	
def ssh_command_log(client, cmdlist, loglist, name):

	i = 0
	nbytes = 4096
	session = client.open_channel(kind='session')
	
	for command in cmdlist:
		print name + " " + command
		stdout_data = []
		stderr_data = []
		session = client.open_channel(kind='session')
		session.exec_command(command)
		while True:
			if session.recv_ready():
				stdout_data.append(session.recv(nbytes))
			if session.recv_stderr_ready():
				stderr_data.append(session.recv_stderr(nbytes))
			if session.exit_status_ready():
				break
				
		fp = open(loglist[i], "wb")
		fp.write(''.join(stdout_data))
		fp.close()		
		i = i + 1
								
	session.close()

def chk_fhascli(client):
	cmdl = ["uname -a"]
	if "Linux" in ssh_command(client, cmdl):
		return False
		
	return True
	
def ssh_command(client, cmdlist):

	i = 0
	nbytes = 4096

	ret = ""
	for command in cmdlist:
		stdout_data = []
		stderr_data = []
		session = client.open_channel(kind='session')
		session.exec_command(command)
		while True:
			if session.recv_ready():
				stdout_data.append(session.recv(nbytes))
			if session.recv_stderr_ready():
				stderr_data.append(session.recv_stderr(nbytes))
			if session.exit_status_ready():
				break					
		ret = ret.join(stdout_data)										
	session.close()
	return ret

def dx_connect(ip, usr, pwd):
	tn = 0	
			
	try:
		tn = telnetlib.Telnet(ip, 23, 20)
		tn.read_until("ENTER USERNAME <", 10)
		tn.write(usr + "\r\n")
		tn.read_until("ENTER PASSWORD <", 10)	
		tn.write(pwd + "\r\n")		
		file_tmp = tmp_local_file(ip)	
		fp = open(file_tmp, "wb")
		fp.write(tn.read_until("WELCOME TO THE", 10))
		fp.close()
		fp = open(file_tmp, "rb")		 
		for l in fp.readlines():
			if "USER AUTHORIZATION FAILURE" in l or "DELAY OF" in l or "DELAY APPLIED" in l:
				fp.close()
				os.remove(file_tmp)
				print ip + " user authorization failure!"
				return None
		
		fp.close()
		os.remove(file_tmp)
		
	except:		
		return None
	return tn
	
def dx_disconnect(tn):
	tn.write("ZZZZ;\n\r")
	
def tmp_local_file(name):		
	fn = str(time.time()).replace(".","")	
	tmpfile = TMP_DIRE + os.sep + name + "_" + fn
	return tmpfile

def tmp_string(name):		
	fn = str(time.time()).replace(".","")	
	tmpfile = name + "_" + fn
	return tmpfile

	
#Send dx200 command via telnet
def send_dx_command(tn, cmd, exp):
	time.sleep (2)
	timeout = 1200
	tn = telnetlib.Telnet(ip)
	tn.read_until("ENTER USERNAME <")
	tn.write(usr + "\r\n")
	tn.read_until("ENTER PASSWORD <")	
	tn.write(pwd + "\r\n")
	i = 0
	ret = ""
	for c in cmd:
		try:
			time.sleep(2)
			tn.write(c + "\r\n")
			ret = ret + tn.read_until(exp[i], timeout)
		except:
			try:
				time.sleep(2)
				tn.write(c + "\r\n")	
				ret = ret + tn.read_until(exp[i], timeout)				
			except:				
				ret = ret + cmd[i] + " Command execution failed!"				
				
		i = i + 1										
	return ret
	
def send_dx_command_log(tn, cmd, exp, log, name):
	i = 0
	timeout = 21600
	for c in cmd:
		print name + " " + c
		try:
			time.sleep(2)
			tn.write(c + "\r\n")
		except:
			try:
				time.sleep(2)
				tn.write(c + "\r\n")			
			except:
				print name + " " + c + " command execution failed!"
				return
				
		ret = tn.read_until(exp[i], timeout)
		fp = open(log[i], "wb")
		fp.write(ret)
		fp.close()		
		i = i + 1
	
def get_ne_type(tn, ip):
	file_tmp = tmp_local_file(ip)
	ret = "-"	
	fp = open(file_tmp, "wb")
		
	fp.write(send_dx_command(tn, ["ZZ?"], ["Z; .... END"]))
	fp.close()
	
	fp = open(file_tmp, "rb")
	for line in fp.readlines():
		if "-" in line and ":" in line:
			ret = line[0:9].strip()
			
	fp.close()
	os.remove(file_tmp)
	return ret;
	
def get_ne_name(tn, ip):	
	file_tmp = tmp_local_file(ip)	
	ret = "-"
	fp = open(file_tmp, "wb")
	fp.write(send_dx_command(tn, ["ZZ?"], ["Z; .... END"]))
	fp.close()
	
	fp = open(file_tmp, "rb")
	for line in fp.readlines():
		if "-" in line and ":" in line:
			ret = line[10:25].strip()
			
	fp.close()
	os.remove(file_tmp)	
	name = ret.split(" ")[0].strip();
	name = strip_non_ascii(name)
	return name
		
def strip_non_ascii(string):
    """ Returns the string without non ASCII characters"""
    stripped = (c for c in string if 0 < ord(c) < 127)
    return ''.join(stripped)	
			
class fns:
	
	def __init__(self, ip, tn, name, logdir):
		#Define workdir:		
		workdir = logdir + os.sep + name + "_running"
		
		#Create the directory:
		if not os.path.exists(workdir):
			os.mkdir(workdir)
										
		#RNC_IP file:
		fp = open(workdir + os.sep + "FNS_IP", "wb")
		fp.write(ip)
		fp.close()

		#ELEMENT_TYPE file:
		fp = open(workdir + os.sep + "ELEMENT_TYPE", "wb")
		fp.write("FlexiNS")
		fp.close()
		
		#RNC_NAME file:
		fp = open(workdir + os.sep + "FNS_NAME", "wb")
		fp.write(name)
		fp.close()
	
		cmdlist = ["ZUSI;", 
			"ZQNI;",
			"ZDOI::M;",
			"ZWQO:CR;",
			"ZWOI;",
			"ZWOS;",						
			"ZWQO:CR;",
			"ZW7I:FEA,FULL:FSTATE=ON;",
			"ZW7I:LIC,FULL;",
			"ZW7I:UCAP;",
			"ZWTI:P;",			
			"ZNET;",
			"ZWVI;",
			"ZEJH;",
			"ZMXP;",
			"ZCFI:::ALL;",
			"ZQRI;",
			"ZWTI:PI;",
			"ZUSI;",
			"ZKAI;",
			"ZOHI:::FULL;",
			"ZBIV:INT;",
			"ZB6I;",
			"ZB6O:TAMAP;",
			"ZNBI;",
			"ZOPJ;",
			"ZE6I;",
			"ZFWI:PGI=;",
			"ZFWI:PAPU=;",
			"ZKAO;",
			"ZFWO:NSEI=0&&65535;",
			"ZEJL:NSEI=0&&65535;",
			"ZGHI;",
			"ZGHH;",
			"ZQRJ;",
			"ZKAQ:INT:LIA=MME;",
			"ZKAQ:INT:LIA=SGSN;",
			"ZTPI;",
			"ZE5I;",
			"ZDDE::\"ZL:M\",\"ZLP:M,MAS\",\"ZMX:W0-LFILES/*.XML\";",	
			"ZDDE::\"ZL:M\",\"ZLP:M,MAS\",\"ZMX:W0-ASWDIR/*.INI\";"]
					
		loglist = [workdir + os.sep + "ZUSI.log",
			workdir + os.sep + "ZQNI.log",
			workdir + os.sep + "ZDOI.log",
			workdir + os.sep + "ZWQO.log",
			workdir + os.sep + "ZWOI.log",
			workdir + os.sep + "ZWOS.log",			
			workdir + os.sep + "ZWQO.log",
			workdir + os.sep + "ZW7IFULL.log",
			workdir + os.sep + "ZW7ILIC.log",
			workdir + os.sep + "ZW7IUCAP.log",
			workdir + os.sep + "ZWTIP.log",			
			workdir + os.sep + "ZNET.log",
			workdir + os.sep + "ZWVI.log",
			workdir + os.sep + "ZEJH.log",
			workdir + os.sep + "ZMXP.log",
			workdir + os.sep + "ZCFI.log",
			workdir + os.sep + "ZQRI.log",
			workdir + os.sep + "ZWTI.log",
			workdir + os.sep + "ZUSI.log",
			workdir + os.sep + "ZKAI.log",
			workdir + os.sep + "ZOHI.log",
			workdir + os.sep + "ZBIV.log",					
			workdir + os.sep + "ZB6I.log",
			workdir + os.sep + "ZB6O.log",
			workdir + os.sep + "ZNBI.log",
			workdir + os.sep + "ZOPJ.log",
			workdir + os.sep + "ZE6I.log",
			workdir + os.sep + "ZFWIPGI.log",
			workdir + os.sep + "ZFWIPAPU.log",
			workdir + os.sep + "ZKAO.log",
			workdir + os.sep + "ZFWO.log",
			workdir + os.sep + "ZEJL.log",
			workdir + os.sep + "ZGHI.log",
			workdir + os.sep + "ZGHH.log",
			workdir + os.sep + "ZQRJ.log",
			workdir + os.sep + "ZKAQ_MME.log",
			workdir + os.sep + "ZKAQ_SGSN.log",
			workdir + os.sep + "ZTPI.log",
			workdir + os.sep + "ZE5I.log",
			workdir + os.sep + "LFILES_XML.log",
			workdir + os.sep + "ASWDIR_INI.log"]
						
		explist = ["COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",					
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",					
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED"]

		send_dx_command_log(tn, cmdlist, explist, loglist, name)
						
		dxipa().get_file(name, tn, workdir, "ASWDIR", "W0-ASWDIR/*.INI", ip)							
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/T4IL*.XML", ip)	
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/TA1LSTNX.XML", ip)			
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/FXC*NX.XML", ip)					
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/XIPIF*.XML", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/POCIP*.IMG", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/PRFI*.IMG", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/FIFI*.IMG", ip)						
		dxipa().get_file(name, tn, workdir, "LICENCE", "W0-LICENCE/*.XML", ip)	
										
		dx_disconnect(tn)
		ssh_disconnect(tn)
		time.sleep(10)
		print name + " Finished!"		
		workdir_finished = workdir.replace("_running","")
		os.rename(workdir, workdir_finished)
				
			
class sgsn:
	
	def __init__(self, ip, tn, name, logdir):
		#Define workdir:		
		workdir = logdir + os.sep + name + "_running"
		
		#Create the directory:
		if not os.path.exists(workdir):
			os.mkdir(workdir)
										
		#RNC_IP file:
		fp = open(workdir + os.sep + "SGSN_IP", "wb")
		fp.write(ip)
		fp.close()

		#ELEMENT_TYPE file:
		fp = open(workdir + os.sep + "ELEMENT_TYPE", "wb")
		fp.write("SGSN")
		fp.close()
		
		#RNC_NAME file:
		fp = open(workdir + os.sep + "SGSN_NAME", "wb")
		fp.write(name)
		fp.close()
	
		cmdlist = ["ZUSI;", 
			"ZQNI;",
			"ZDOI::M;",
			"ZWQO:CR;",
			"ZWOI;",
			"ZWOS;",						
			"ZWQO:CR;",
			"ZW7I:FEA,FULL:FSTATE=ON;",
			"ZW7I:LIC,FULL;",
			"ZW7I:UCAP;",
			"ZWTI:P;",			
			"ZNET;",
			"ZWVI;",
			"ZEJH;",
			"ZMXP;",
			"ZCFI:::ALL;",
			"ZQRI;",
			"ZWTI:PI;",
			"ZUSI;",
			"ZKAI;",
			"ZNBI;",
			"ZOPJ;",
			"ZE6I;",
			"ZFWI:PGI=;",
			"ZFWI:PAPU=;",
			"ZFWO:NSEI=0&&65535;",
			"ZEJL:NSEI=0&&65535;",					
			"ZGHI;",
			"ZGHH;",
			"ZQRJ;",
			"ZTPI;",
			"ZE5I;",
			"ZDDE::\"ZL:M\",\"ZLP:M,MAS\",\"ZMX:W0-LFILES/*.XML\";",	
			"ZDDE::\"ZL:M\",\"ZLP:M,MAS\",\"ZMX:W0-ASWDIR/*.INI\";"]
					
		loglist = [workdir + os.sep + "ZUSI.log",
			workdir + os.sep + "ZQNI.log",
			workdir + os.sep + "ZDOI.log",
			workdir + os.sep + "ZWQO.log",
			workdir + os.sep + "ZWOI.log",
			workdir + os.sep + "ZWOS.log",			
			workdir + os.sep + "ZWQO.log",
			workdir + os.sep + "ZW7IFULL.log",
			workdir + os.sep + "ZW7ILIC.log",
			workdir + os.sep + "ZW7IUCAP.log",
			workdir + os.sep + "ZWTIP.log",			
			workdir + os.sep + "ZNET.log",
			workdir + os.sep + "ZWVI.log",
			workdir + os.sep + "ZEJH.log",
			workdir + os.sep + "ZMXP.log",
			workdir + os.sep + "ZCFI.log",
			workdir + os.sep + "ZQRI.log",
			workdir + os.sep + "ZWTI.log",
			workdir + os.sep + "ZUSI.log",
			workdir + os.sep + "ZKAI.log",
			workdir + os.sep + "ZNBI.log",
			workdir + os.sep + "ZOPJ.log",
			workdir + os.sep + "ZE6I.log",
			workdir + os.sep + "ZFWIPGI.log",
			workdir + os.sep + "ZFWIPAPU.log",		
			workdir + os.sep + "ZFWO.log",
			workdir + os.sep + "ZEJL.log",
			workdir + os.sep + "ZGHI.log",
			workdir + os.sep + "ZGHH.log",
			workdir + os.sep + "ZQRJ.log",
			workdir + os.sep + "ZTPI.log",
			workdir + os.sep + "ZE5I.log",
			workdir + os.sep + "LFILES_XML.log",
			workdir + os.sep + "ASWDIR_INI.log"]
						
		explist = ["COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",					
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",					
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED"]

		send_dx_command_log(tn, cmdlist, explist, loglist, name)
															
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/XIPIF*.XML", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/POCIP*.IMG", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/PRFI*.IMG", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/FIFI*.IMG", ip)						
		dxipa().get_file(name, tn, workdir, "LICENCE", "W0-LICENCE/*.XML", ip)
										
		dx_disconnect(tn)
		ssh_disconnect(tn)
		time.sleep(10)
		print name + " Finished!"		
		workdir_finished = workdir.replace("_running","")
		os.rename(workdir, workdir_finished)
				




class rnc:
	
	def __init__(self, ip, tn, name, logdir):
		#Define workdir:		
		workdir = logdir + os.sep + name + "_running"
		
		#Create the directory:
		if not os.path.exists(workdir):
			os.mkdir(workdir)
				
						
		#RNC_IP file:
		fp = open(workdir + os.sep + "RNC_IP", "wb")
		fp.write(ip)
		fp.close()

		#ELEMENT_TYPE file:
		fp = open(workdir + os.sep + "ELEMENT_TYPE", "wb")
		fp.write("RNC")
		fp.close()

		#RNC_TYPE_TYPE file:
		fp = open(workdir + os.sep + "RNC_TYPE", "wb")
		fp.write("RNC")
		fp.close()
		
		#RNC_NAME file:
		fp = open(workdir + os.sep + "RNC_NAME", "wb")
		fp.write(name)
		fp.close()
																				    	   
	
		cmdlist = ["ZUSI;", 
			"ZDDE::\"ZL:1\",\"ZLE:1,MRSTREGX\",\"Z1I\";" ,
			"ZZDDE::\"ZL:1\",\"ZLE:1,RUOSTEQX\",\"Z1SC\";",
			"ZDOI::M;",
			"ZWQO:CR;",
			"ZWOI;",
			"ZWOS;",						
			"ZWQO:CR;",
			"ZW7I:FEA,FULL:FSTATE=ON;",
			"ZW7I:LIC,FULL;",
			"ZW7I:UCAP;",
			"ZWFI:P;",
			"ZWFL:P;",	
			"ZNET;"]
					
		loglist = [workdir + os.sep + "ZUSI.log",
			workdir + os.sep + "TARGET_ID.log",
			workdir + os.sep + "WBTS_IP.log",						
			workdir + os.sep + "ZDOI.log",
			workdir + os.sep + "ZWQO.log",
			workdir + os.sep + "ZWOI.log",
			workdir + os.sep + "ZWOS.log",			
			workdir + os.sep + "ZWQO.log",
			workdir + os.sep + "ZW7IFULL.log",
			workdir + os.sep + "ZW7ILIC.log",
			workdir + os.sep + "ZW7IUCAP.log",
			workdir + os.sep + "ZWFI.log",
			workdir + os.sep + "ZWFL.log",
			workdir + os.sep + "ZNET.log"]
						
		explist = ["COMMAND EXECUTED", 
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED"] 

		send_dx_command_log(tn, cmdlist, explist, loglist, name)		
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/XIPIF*.XML", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/POCIP*.IMG", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/PRFI*.IMG", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/FIFI*.IMG", ip)								
		dxipa().get_file(name, tn, workdir, "LICENCE", "W0-LICENCE/*.XML", ip)
						
		dx_disconnect(tn)
		time.sleep(10)		
		print name + " Finished!"		
		workdir_finished = workdir.replace("_running","")
		os.rename(workdir, workdir_finished)
		
		
							
class mcrnc:
	
	def __init__(self, ip, tn, name, logdir, targetid):
		#Define workdir:		
		workdir = logdir + os.sep + name + "_running"
		
		#Create the directory:
		if not os.path.exists(workdir):
			os.mkdir(workdir)
				
						
		#RNC_IP file:
		fp = open(workdir + os.sep + "RNC_IP", "wb")
		fp.write(ip)
		fp.close()
		
		#RNC_TargetID file:
		fp = open(workdir + os.sep + "TARGET_ID", "wb")
		fp.write(targetid)
		fp.close()		

		#ELEMENT_TYPE file:
		fp = open(workdir + os.sep + "ELEMENT_TYPE", "wb")
		fp.write("RNC")
		fp.close()

		#RNC_TYPE_TYPE file:
		fp = open(workdir + os.sep + "RNC_TYPE", "wb")
		fp.write("mcRNC")
		fp.close()
		
		#RNC_NAME file:
		fp = open(workdir + os.sep + "RNC_NAME", "wb")
		fp.write(name)
		fp.close()
																				    	   
	
		cmdlist = ["set cli built-in rows -1", 		
			"show license all",
			"show sw-manage app-sw-mgmt builds",
			"show license feature-mgmt usage all",
			"show signaling ss7 local-as all",						
			"show hardware inventory list detailed",
			"show hardware state list",
			"show has functional-unit unit-info"]
					
		loglist = [workdir + os.sep + "set_cli_built.log",
			workdir + os.sep + "licences.log",
			workdir + os.sep + "sw_delivery_id.log",						
			workdir + os.sep + "features.log",
			workdir + os.sep + "ss7.log",
			workdir + os.sep + "hw_inv.log",
			workdir + os.sep + "hw_state.log",			
			workdir + os.sep + "func_unit.log"]
								
		ssh_command_log(tn, cmdlist, loglist, name)		
		time.sleep(10)
		ssh_disconnect(tn)
		print name + " Finished!"		
		workdir_finished = workdir.replace("_running","")
		os.rename(workdir, workdir_finished)
									
class netact_old:
	def __init__(self, ip, tn, ne_name, logname, _usr, _pwd):
					
		racclimx_path = "/opt/nokianms/bin/racclimx.sh "
		class_filter = "'LNBTS,LNCEL,LNMME,MRBTS,A2NE,A2ST,A2UT,ADJG,ADJI,ADJL,ADJS,AMGR,ANBA,ANTL,BFD,BFDGRP,BTSSCW,CCFA,CERTH,CESIF,CMOB,COCO,ETHLK,FMCG,FMCI,FMCS,FTM,HOPG,HOPI,HOPL,HOPS,IAIF,IEIF,IHCP,IMAG,INTP,IPNB,IPNO,IPQM,IPRM,IPRT,IUCS,IUO,IUPS,IUPSIP,IUR,IVIF,L2SWI,LCELGW,LCELW,MRBTS,OSPFV2,PPTT,PWNE,QOS,RMOD,RNAC,RNC,BSC,RNFC,RNHSPA,RNMOBI,RNPS,RNRLC,RNTRM,SMOD,STPG,SYNC,TCTT,TMPAR,TOPIK,TRDE,TWAMP,UNIT,VCCT,VCTT,VPCT,VPTT,WAC,WBTS,WCEL,WRAB'"		
		xml_name = ne_name + "_" + getDateString()
		absolute_xml_name = "/var/opt/nokia/oss/global/racops/export/" + xml_name + ".xml"
		
		if os.path.isfile(LOG_DIRE + os.sep + xml_name + ".zip"):
			ssh_disconnect(tn)
			return
																			
		cmd = "nohup " + racclimx_path + " -op Import_Export -fileFormat RAML2 -importExportOperation actualExport -fileName " + xml_name + ".xml -classFilter " + class_filter + "&"
					
		cmdlist = [cmd]			
		loglist = [TMP_DIRE + os.sep + ne_name + "_export.log"]
		ssh_command_log(tn,cmdlist,loglist,ne_name);
					
		#Wait xml to finish:
		loop = True
		ct = 0
		while loop:
			ct += 1			
			time.sleep(30)
			file_tmp = tmp_local_file(ip)
			cmdlist = ["tail -10 " + absolute_xml_name]
			loglist = [file_tmp]
			ssh_command_log(tn, cmdlist, loglist, ne_name)						
			ft = open(file_tmp, "rb")
			for lli in ft.readlines():				
				if "</raml>" in lli:
					loop = False
					break									
			if ct > 40:
				break								
			ft.close()																																			
			
		#When finished, zip the file:
		cmdlist = ["zip -j /tmp/" + xml_name + ".zip " + absolute_xml_name, 
			"rm " + absolute_xml_name]														
		loglist = [TMP_DIRE + os.sep + ne_name + "_xml.log",
			TMP_DIRE + os.sep + ne_name + "_rm.log"]
		ssh_command_log(tn,cmdlist,loglist,ne_name);
		
		#And download the zip file:
		src = "/tmp/" + xml_name + ".zip"
		dst = LOG_DIRE + os.sep + xml_name + ".zip" 					
		try:
			print "Getting " + src + " from " + ip
			copy_sftp_file(ip, _usr, _pwd, src, dst)	
			print "Ok!"
		except:
			print "Error!"
			
		ssh_disconnect(tn)	
		
									
class netact:
	def __init__(self, ip, tn, ne_name, logname, _usr, _pwd):
					
		racclimx_path = "/opt/oss/bin/racclimx.sh"
		class_filter = "'LNBTS,LNCEL,LNMME,MRBTS,A2NE,A2ST,A2UT,ADJG,ADJI,ADJL,ADJS,AMGR,ANBA,ANTL,BFD,BFDGRP,BTSSCW,CCFA,CERTH,CESIF,CMOB,COCO,ETHLK,FMCG,FMCI,FMCS,FTM,HOPG,HOPI,HOPL,HOPS,IAIF,IEIF,IHCP,IMAG,INTP,IPNB,IPNO,IPQM,IPRM,IPRT,IUCS,IUO,IUPS,IUPSIP,IUR,IVIF,L2SWI,LCELGW,LCELW,MRBTS,OSPFV2,PPTT,PWNE,QOS,RMOD,RNAC,RNC,BSC,RNFC,RNHSPA,RNMOBI,RNPS,RNRLC,RNTRM,SMOD,STPG,SYNC,TCTT,TMPAR,TOPIK,TRDE,TWAMP,UNIT,VCCT,VCTT,VPCT,VPTT,WAC,WBTS,WCEL,WRAB'"		
		xml_name = ne_name + "_" + getDateString()
		absolute_xml_name = "/var/opt/oss/global/racops/export/" + xml_name + ".xml"
		
		if os.path.isfile(LOG_DIRE + os.sep + xml_name + ".zip"):
			ssh_disconnect(tn)
			return
																			
		cmd = "nohup " + racclimx_path + " -op Import_Export -fileFormat RAML2 -importExportOperation actualExport -fileName " + xml_name + ".xml -classFilter " + class_filter + "&"
					
		cmdlist = [cmd]			
		loglist = [TMP_DIRE + os.sep + ne_name + "_export.log"]
		ssh_command_log(tn,cmdlist,loglist,ne_name);
					
		#Wait xml to finish:
		loop = True
		ct = 0
		while loop:
			ct += 1			
			time.sleep(30)
			file_tmp = tmp_local_file(ip)
			cmdlist = ["tail -10 " + absolute_xml_name]
			loglist = [file_tmp]
			ssh_command_log(tn, cmdlist, loglist, ne_name)						
			ft = open(file_tmp, "rb")
			for lli in ft.readlines():				
				if "</raml>" in lli:
					loop = False
					break									
			if ct > 40:
				break								
			ft.close()																																			
			
		#When finished, zip the file:
		cmdlist = ["zip -j /tmp/" + xml_name + ".zip " + absolute_xml_name, 
			"rm " + absolute_xml_name]														
		loglist = [TMP_DIRE + os.sep + ne_name + "_xml.log",
			TMP_DIRE + os.sep + ne_name + "_rm.log"]
		ssh_command_log(tn,cmdlist,loglist,ne_name);
		
		#And download the zip file:
		src = "/tmp/" + xml_name + ".zip"
		dst = LOG_DIRE + os.sep + xml_name + ".zip" 					
		try:
			print "Getting " + src + " from " + ip
			copy_sftp_file(ip, _usr, _pwd, src, dst)	
			print "Ok!"
		except:
			print "Error!"
			
		ssh_disconnect(tn)			


class dxipa():
	def __init__(self):
		self.netype = 0
					
	def get_file(self, name, tn, workdir, destdir, fname, ip):		
		dire = ""
		if not os.path.exists(workdir + os.sep + destdir):
			os.mkdir(workdir + os.sep + destdir)
			
		file_tmp = tmp_local_file(ip)
		
		cmdlist = ["ZDDE::\"ZL:M\",\"ZLP:M,MAS\",\"ZMX:" + fname + "\";"]
		explist = ["COMMAND EXECUTED"]
		loglist = [file_tmp]
		send_dx_command_log(tn, cmdlist, explist, loglist, name)
				
		fp = open(file_tmp, "rb")
		ft = False
		filelist = []
		for line in fp.readlines():			
			if "DIRECTORY OF" in line:
				dire = line.split()[2]
			if "YY-MM-DD" in line:
				ft = True
			elif "TOTAL   " in line:
				ft = False
			elif ft == True:
				if not "LETTERGX" in line:	 # blacklist LETTERGX because it's very big and has no util information			
					filelist.append(line.split()[1] + line.split()[2])
		fp.close()
		
		for f in filelist:			
			cmdlist = ["ZDDE::\"ZMTE:W0-" + dire + f + "\";"]
			explist = ["COMMAND EXECUTED"]
			loglist = [workdir + os.sep + destdir + os.sep + f + ".log"]
			if not os.path.exists(workdir + os.sep + destdir):
				os.mkdir(workdir + os.sep + destdir)

			send_dx_command_log(tn, cmdlist, explist, loglist, name)
			
			fp = open(workdir + os.sep + destdir + os.sep + f + ".log", "rb")
			lic = open(workdir + os.sep + destdir + os.sep + f, "wb")
			linex = ""			
			for lin in fp.readlines():				
				if "NO SUCH FILE" in lin:		
					break
				elif ":  " in lin:
					for val in lin[5:56].strip().split(" "):
						lic.write("%c" % int(val, 16))
				
			fp.close()
			lic.close()
			time.sleep(2)
			try:
				os.remove(workdir + os.sep + destdir + os.sep + f + ".log")
			except:
				print name + " failed to remove " + workdir + os.sep + destdir + os.sep + f + ".log"

						
class bsc:
	
	def __init__(self, ip, tn, name, logdir):
		#Define workdir:		
		workdir = logdir + os.sep + name + "_running"
		
		#Create the directory:
		if not os.path.exists(workdir):
			os.mkdir(workdir)
				
				
		zeei = "ZEEI;"
		tmp_log = tmp_local_file(name)		
		fp = open(tmp_log, "wb")
		fp.write(send_dx_command(tn, ["ZWOS:2,665;"], ["COMMAND EXECUTED"]))
		fp.close()		
		fp = open(tmp_log, "rb")
		seg = 0
		for line in fp.readlines():
			if " ACTIVATED" in line:
				zeei = "ZEEI:SEG=ALL;"
		fp.close()
		os.remove(tmp_log)						
		
		#BSC_IP file:
		fp = open(workdir + os.sep + "BSC_IP", "wb")
		fp.write(ip)
		fp.close()

		#ELEMENT_TYPE file:
		fp = open(workdir + os.sep + "ELEMENT_TYPE", "wb")
		fp.write("BSC")
		fp.close()

		#BSC_TYPE_TYPE file:
		fp = open(workdir + os.sep + "BSC_TYPE", "wb")
		fp.write("BSC")
		fp.close()
		
		#BSC_NAME file:
		fp = open(workdir + os.sep + "BSC_NAME", "wb")
		fp.write(name)
		fp.close()
		
										
		
		cmdlist = ["ZQNI;", 
			"ZDFD:OMU:88E;", 
			"ZQLI;", 
			"ZQRI:OMU;", 
			zeei]
					
		loglist = [workdir + os.sep + "ZQNI.log",
			workdir + os.sep + "Q3VERSION.log",
			workdir + os.sep + "ZQLI.log",
			workdir + os.sep + "ZQRIOMU.log",
			workdir + os.sep + "ZEEI.log"]
			
			
		explist = ["COMMAND EXECUTED", 
					"COMMAND EXECUTED", 
					"COMMAND EXECUTED", 
					"COMMAND EXECUTED", 					
					"COMMAND EXECUTED"]
		
		send_dx_command_log(tn, cmdlist, explist, loglist, name)
		
		#Get max bts-id number from ZEEI.log. The value is initiated with 10
		max_bts = 10;  
		max_bcf = 10;
		fp = open(workdir + os.sep + "ZEEI.log", "rb")
		out = fp.readlines()
		
		for line in out:
			if "BTS-" in line:
				bts = line.split("BTS-")[1].split(" ")[0]				
				if int(bts) > max_bts:
					max_bts = int(bts)
		
		max_bcf = max_bts												
		if int(max_bcf) > 3000:
			max_bcf = 3000
																    	   
		fp.close()
		
		cmdlist = ["ZERO:BTS=1&&" + str(max_bts) + ";", 
			"ZEQO:BTS=1&&" + str(max_bts) + ":ALL;" ,
			"ZEWO:1&&" + str(max_bcf) + ";",
			"ZEEI::BCSU;",
			"ZTPI;",
			"ZWQV:OMU:PRFILEGX;",
			"ZWQV:OMU:FIFILEGX;",
			"ZUSI;",
			"ZDOI::M;",
			"ZWQO:CR;",
			"ZWOI;",
			"ZWOS;",
			"ZWTI:PI;",
			"ZW7I:FEA,FULL:FSTATE=ON;",
			"ZW7I:LIC,FULL;",
			"ZW7I:UCAP;",
			"ZNET;"]
					
		loglist = [workdir + os.sep + "ZERO.log",
			workdir + os.sep + "ZEQO.log",
			workdir + os.sep + "ZEWO.log",
			workdir + os.sep + "ZEEIBCSU.log",
			workdir + os.sep + "ZTPI.log",
			workdir + os.sep + "PRFILEGX_VER.log",
			workdir + os.sep + "FIFILEGX_VER.log",
			workdir + os.sep + "ZUSI.log",
			workdir + os.sep + "ZDOI.log",
			workdir + os.sep + "ZWQO.log",
			workdir + os.sep + "ZWOI.log",
			workdir + os.sep + "ZWOS.log",
			workdir + os.sep + "ZWTI.log",
			workdir + os.sep + "ZW7IFULL.log",
			workdir + os.sep + "ZW7ILIC.log",
			workdir + os.sep + "ZW7IUCAP.log",
			workdir + os.sep + "ZNET.log"]
						
		explist = ["COMMAND EXECUTED", 
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED",
					"COMMAND EXECUTED"] 

		send_dx_command_log(tn, cmdlist, explist, loglist, name)		
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/XIPIF*.XML", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/POCIP*.IMG", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/PRFI*.IMG", ip)
		dxipa().get_file(name, tn, workdir, "LFILES", "W0-LFILES/FIFI*.IMG", ip)						
		dxipa().get_file(name, tn, workdir, "LICENCE", "W0-LICENCE/*.XML", ip)
		
		dx_disconnect(tn)
		print name + " Finished!"
		time.sleep(2)		
		workdir_finished = workdir.replace("_running","")
		try:
			os.rename(workdir, workdir_finished)
		except:
			print "Error on rename " + workdir
		
		
			
						
def get_ne_name_mc_rnc(tn, ip):
	ret = "unknow"
	ssh_command(tn, ["set cli built-in rows -1"])	
	file_tmp = tmp_local_file(ip)
	fp = open(file_tmp, "wb")
	fp.write(ssh_command(tn, ["show radio-network omsconn"]))
	fp.close()
	
	fp = open(file_tmp, "rb")
	for line in fp.readlines():
		if "RNC name:" in line:
			ret = line[20:75].strip()
		
	fp.close()
	os.remove(file_tmp)
		
	return ret

def get_ne_name_linux(tn, ip):
	ret = "unknow"	
	file_tmp = tmp_local_file(ip)
	fp = open(file_tmp, "wb")
	fp.write(ssh_command(tn, ["uname -n"]))
	time.sleep(2)
	fp.write(ssh_command(tn, ["uname -n"]))
	time.sleep(2)
	fp.write(ssh_command(tn, ["uname -n"]))
	time.sleep(2)
	fp.write(ssh_command(tn, ["uname -n"]))
	time.sleep(2)
	fp.write(ssh_command(tn, ["uname -n"]))
	time.sleep(2)	
	fp.close()
	
	fp = open(file_tmp, "rb")
	for line in fp.readlines():		
		if not "uname -n" in line:
			ret = line.strip()		
	fp.close()
	os.remove(file_tmp)	
	return ret
				
				
def get_ne_target_id_mc_rnc(tn, ip):
	ret = "unknow"
	ssh_command(tn, ["set cli built-in rows -1"])	
	file_tmp = tmp_local_file(ip)
	fp = open(file_tmp, "wb")
	fp.write(ssh_command(tn, ["show license target-id"]))
	fp.close()
	
	fp = open(file_tmp, "rb")
	for line in fp.readlines():		
		if "Target ID " in line:
			ret = line[20:75].strip()
		
	fp.close()
	os.remove(file_tmp)
		
	return ret
		
def get_ne_type_flexi_platform(tn, ip):
	ret = "unknow"
	cmdl = ["set cli built-in rows -1"]
	l = ssh_command(tn, cmdl)		
	if "CFPU-" in l:
		ret = "mcRNC"
		
	return ret
	
#Global:  LOG_DIRE and TMP_DIRE
TMP_DIRE = "tmp"
LOG_DIRE = "logs"


try:
	nelst = open("ne.csv", "r")

except:	
	raw_input("File ne.csv doesn't exist.  Please, generate this file and start it again.\n \
	\nExample of ne.csv content: \n \
	\n10.222.10.11,DX200,SYSTEM,SYSTEM \
	\n10.222.10.12,IPAD200,USERNAME,PASSWORD \
	\n10.222.10.13,mcRNC,_nokadmin,system\n \
	\n")
	
	sys.exit()


if os.path.exists(LOG_DIRE) and os.path.isdir(LOG_DIRE):
	while True:
		rm_conf = raw_input("Directory " + LOG_DIRE + "already exists. \
		\nDo you want to remove it? (Yes/No)\
		\nYes --> Remove the directory and subdirectories\n\
		          and get all logs from beginner;\n\
		\nNo  --> Keep the directory and remove only the\n\
		          subdirectories that contain \"_running\" on its name.\
		\nOption:")
		
		if "Yes" in rm_conf or "No" in rm_conf:	
			break;
		else:
			print "\nInvalid option. Please:  \"Yes\" or \"No\""
	
	if "Yes" in rm_conf:
		if os.path.exists(LOG_DIRE):
			shutil.rmtree(LOG_DIRE)
	else:
		for fi in os.listdir(LOG_DIRE):
			if "_running" in fi:
				shutil.rmtree(LOG_DIRE + os.sep + fi)
					
tot = 0
for n in nelst.readlines():
	tot += 1
	
nelst.close()

#Create a temp directory:
if os.path.exists(TMP_DIRE):
	shutil.rmtree(TMP_DIRE)
		
os.mkdir(TMP_DIRE)
max_sim_thread = 50
	
#Create the log directory:
if not os.path.exists(LOG_DIRE):
	os.mkdir(LOG_DIRE)
		
wait_time = 30
curr = 0
dir_tot = 0
dir_list = {}
nelst = open("ne.csv", "r")
for line in nelst.readlines():
	curr += 1
	if not line.startswith("#") and len(line.strip()) > 2:		
		ip = line.split(",")[0]
		plat = line.split(",")[1]
		usr = line.split(",")[2]
		pwd = line.split(",")[3]			
		logname = LOG_DIRE
		if "DX200" in plat or "IPA2800" in plat:
			print "(" + str(curr) + " of " + str(tot) + ") Openning telnet connection to " + ip + "..."
			tna = dx_connect(ip, usr, pwd)
			if tna:
				print "Connection to " + ip + " established!"
				print "Getting " + ip + " element type..."
				ne_type = get_ne_type(tna, ip)								
				print ip + " is " + ne_type
				ne_name = get_ne_name(tna, ip)
				print ip + " is " + ne_type + " and its name is " + ne_name

				#Add ne_name to dir list, to be zipped later:
				dir_tot += 1
				dir_list[dir_tot] = ne_name
				
				running_dire =  LOG_DIRE + os.sep + ne_name + "_running"
				work_dire = LOG_DIRE + os.sep + ne_name
								
				if os.path.isdir(running_dire):
					shutil.rmtree(running_dire)
				
				if os.path.isdir(work_dire):
					dx_disconnect(tna)
				else:			
					if "BSC" in ne_type:				
						bsc_thread = threading.Thread(target=bsc, args=(ip, tna, ne_name, logname))
						bsc_thread.start()
						
					elif "RNC" in ne_type:
						rnc_thread = threading.Thread(target=rnc, args=(ip, tna, ne_name, logname))
						rnc_thread.start()
						
					elif "Flexi NS" in ne_type:
						fns_thread = threading.Thread(target=fns, args=(ip, tna, ne_name, logname))
						fns_thread.start()

					elif "SGSN" in ne_type:
						sgsn_thread = threading.Thread(target=sgsn, args=(ip, tna, ne_name, logname))
						sgsn_thread.start()															

						
			else:
				print "Connection to " + ip + " failed!"
		
		elif "mcRNC" in plat:
			print "(" + str(curr) + " of " + str(tot) + ") Openning ssh connection to " + ip + "..."
			usr = usr.strip()
			pwd = pwd.strip()
			tna = ssh_connect(ip, usr, pwd)
			if tna:
				print "Connection to " + ip + " established!"				
				if chk_fhascli(tna):
					print "Getting " + ip + " element type..."												
					ne_type = get_ne_type_flexi_platform(tna, ip)
					print ip + " is " + ne_type
					ne_name = get_ne_name_mc_rnc(tna, ip)
					
					#Add ne_name to dir list, to be zipped later:
					dir_tot += 1
					dir_list[dir_tot] = ne_name			
					
					print ip + " is " + ne_type + " and its name is " + ne_name
					ne_target_id = get_ne_target_id_mc_rnc(tna, ip) 						
					print "NE_type = " + ne_type
					
					running_dire =  LOG_DIRE + os.sep + ne_name + "_running"
					work_dire = LOG_DIRE + os.sep + ne_name
								
					if os.path.isdir(running_dire):
						shutil.rmtree(running_dire)
				
					if os.path.isdir(work_dire):														
						ssh_disconnect(tna)
					else:
						if "mcRNC" in ne_type:
							mcrnc_thread = threading.Thread(target=mcrnc, args=(ip, tna, ne_name, logname, ne_target_id))
							mcrnc_thread.start()
					
				else:
					print "Must be fhasclish user!"
					ssh_disconnect(tna)

		elif "Netact_old" in plat:
			print "(" + str(curr) + " of " + str(tot) + ") Openning ssh connection to " + ip + "..."
			usr = usr.strip()
			pwd = pwd.strip()
			tna = ssh_connect(ip, usr, pwd)
			if tna:
				print "Connection to " + ip + " established!"				
				ne_name = get_ne_name_linux(tna, ip)
				print ip + " name is " + ne_name																			
				netact_old_thread = threading.Thread(target=netact_old, args=(ip, tna, ne_name, logname, usr, pwd))
				netact_old_thread.start()
				
		elif "Netact" in plat:
			print "(" + str(curr) + " of " + str(tot) + ") Openning ssh connection to " + ip + "..."
			usr = usr.strip()
			pwd = pwd.strip()
			tna = ssh_connect(ip, usr, pwd)
			if tna:
				print "Connection to " + ip + " established!"				
				ne_name = get_ne_name_linux(tna, ip)
				print ip + " name is " + ne_name																			
				netact_thread = threading.Thread(target=netact, args=(ip, tna, ne_name, logname, usr, pwd))
				netact_thread.start()						
				
				
		running = max_sim_thread
		
		#Wait threads
		while running >= max_sim_thread:
			nn = 0
			for t in threading.enumerate():
				nn = nn + 1
				running = nn
				if running >= max_sim_thread:
					print "Processed NEs: " + str((curr - 1)) + " of " + str(tot)
					time.sleep(wait_time)


nn = 10
while nn > 1:
	nn = 0
	for t in threading.enumerate():
		nn = nn + 1
	
	time.sleep(10)

#Remove the temp directory:
if os.path.exists(TMP_DIRE):
	shutil.rmtree(TMP_DIRE)
	
#After that, zip the log directories and remove them

zipf = zipfile.ZipFile(LOG_DIRE + os.sep + "NELogs_" + getDateString() + ".zip", 'w',  zipfile.ZIP_DEFLATED)
os.chdir(LOG_DIRE)

for x in range(1, (dir_tot + 1)):
	try:		
		zipdir(dir_list[x], zipf)
	except:
		print "Error on " + dir_list[x] + " zip attempt!"
		
	try:
		shutil.rmtree(dir_list[x])
	except:
		print "Error on " + dir_list[x] + " deletion attempt!"
	   
zipf.close()
		
	
raw_input("Script has been finished!")


